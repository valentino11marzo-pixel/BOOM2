'use client'
import { useEffect, useState } from 'react'
import { createClient } from '@supabase/supabase-js'
const supabase = createClient(process.env.NEXT_PUBLIC_SUPABASE_URL, process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY)
function eur(c){ if(typeof c!=='number') return '—'; return (c/100).toLocaleString('it-IT',{style:'currency',currency:'EUR'})}
export default function Listings(){const [items,setItems]=useState([]);const [loading,setLoading]=useState(true);const [error,setError]=useState(null);useEffect(()=>{(async()=>{setLoading(true);const {data,error}=await supabase.from('listings').select(`id, slug, monthly_rent_eur, expenses_included, term_min_months, term_max_months, units:unit_id ( title, area_sqm, beds, baths )`).eq('is_active',true).order('created_at',{ascending:false});if(error) setError(error.message); else setItems(data||[]);setLoading(false);})()},[]);if(loading) return <main className='max-w-5xl mx-auto px-4 py-8'>Carico…</main>;if(error) return <main className='max-w-5xl mx-auto px-4 py-8 text-red-400'>Errore: {error}</main>;return(<main className='max-w-5xl mx-auto px-4 py-8'><h1 className='text-2xl font-bold'>Annunci (Roma)</h1><div className='grid md:grid-cols-3 gap-4 mt-4'>{items.map(it=>{const u=it.units||{};return(<div key={it.id} className='card'><div className='aspect-[4/3] bg-white/10 rounded-lg mb-2 flex items-center justify-center'><span className='text-white/50 text-sm'>Foto</span></div><div className='font-semibold'>{u.title||'—'}</div><div className='text-sm text-white/70'>{eur(it.monthly_rent_eur)} / mese · {u.beds??'—'} bed · {u.baths??'—'} bath · {it.term_min_months}–{it.term_max_months} mesi · {it.expenses_included? 'spese incluse':'spese escluse'}</div><div className='mt-2 flex gap-2'><a className='btn' href='/dashboard'>Richiedi</a><a className='btn btn-outline' href='/terms.html'>Termini</a></div></div>)})}</div></main>)}
